name: Update Sitemap

on:
  push:
    branches: ["main"]
    paths:
      - '**.html'
      - 'pages/**'
  workflow_dispatch:

jobs:
  update-sitemap:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Update sitemap lastmod dates
        run: |
          TODAY=$(date +%Y-%m-%d)

          # Create new sitemap with updated dates
          cat > sitemap.xml << EOF
          <?xml version="1.0" encoding="UTF-8"?>
          <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">

              <!-- Homepage -->
              <url>
                  <loc>https://yaboixanny.github.io/cleaningsite/</loc>
                  <lastmod>${TODAY}</lastmod>
                  <changefreq>weekly</changefreq>
                  <priority>1.0</priority>
              </url>

              <!-- Service Pages -->
              <url>
                  <loc>https://yaboixanny.github.io/cleaningsite/pages/residential.html</loc>
                  <lastmod>${TODAY}</lastmod>
                  <changefreq>monthly</changefreq>
                  <priority>0.9</priority>
              </url>

              <url>
                  <loc>https://yaboixanny.github.io/cleaningsite/pages/commercial.html</loc>
                  <lastmod>${TODAY}</lastmod>
                  <changefreq>monthly</changefreq>
                  <priority>0.9</priority>
              </url>

              <url>
                  <loc>https://yaboixanny.github.io/cleaningsite/pages/high-rise.html</loc>
                  <lastmod>${TODAY}</lastmod>
                  <changefreq>monthly</changefreq>
                  <priority>0.8</priority>
              </url>

              <url>
                  <loc>https://yaboixanny.github.io/cleaningsite/pages/screen-services.html</loc>
                  <lastmod>${TODAY}</lastmod>
                  <changefreq>monthly</changefreq>
                  <priority>0.8</priority>
              </url>

              <url>
                  <loc>https://yaboixanny.github.io/cleaningsite/pages/gutter-cleaning.html</loc>
                  <lastmod>${TODAY}</lastmod>
                  <changefreq>monthly</changefreq>
                  <priority>0.8</priority>
              </url>

              <url>
                  <loc>https://yaboixanny.github.io/cleaningsite/pages/pressure-washing.html</loc>
                  <lastmod>${TODAY}</lastmod>
                  <changefreq>monthly</changefreq>
                  <priority>0.8</priority>
              </url>

              <!-- Info Pages -->
              <url>
                  <loc>https://yaboixanny.github.io/cleaningsite/pages/about.html</loc>
                  <lastmod>${TODAY}</lastmod>
                  <changefreq>monthly</changefreq>
                  <priority>0.7</priority>
              </url>

              <url>
                  <loc>https://yaboixanny.github.io/cleaningsite/pages/contact.html</loc>
                  <lastmod>${TODAY}</lastmod>
                  <changefreq>monthly</changefreq>
                  <priority>0.7</priority>
              </url>

              <url>
                  <loc>https://yaboixanny.github.io/cleaningsite/pages/service-area.html</loc>
                  <lastmod>${TODAY}</lastmod>
                  <changefreq>monthly</changefreq>
                  <priority>0.7</priority>
              </url>

          </urlset>
          EOF

          echo "Sitemap updated with date: ${TODAY}"

      - name: Commit and push if changed
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add sitemap.xml
          git diff --staged --quiet || git commit -m "Auto-update sitemap lastmod to $(date +%Y-%m-%d)"
          git push
